
            <!DOCTYPE html>
            <html lang="zh-CN">
                <head>
                    <meta charset="UTF-8">
                    <title>
 ffmpeg 源代码简单分析 ： av_register_all() - CSDN博客
</title>

                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/detail-60a2c245da.min.css">
                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/themes/skin3-template/skin3-template-88717cedf2.min.css">

                <script type="text/javascript">
                var username = "";
                </script>

                <script src="https://csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>

                <!-- 新版上报 -->
                <!-- 新版上报end -->
                <link rel="stylesheet" href="https://csdnimg.cn/public/sandalstrap/1.3/css/sandalstrap.min.css"> 
                </head>
                <body>    
        
                    <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
                    <div class="container clearfix pt0" id="mainBox">
        <main style="width: 100%;"><div class="blog-content-box">
 <div class="article-title-box" id="article_anchors_396">
  <span class="article-type type-1 float-left">
   原
  </span>
  <h1 class="title-article">
   ffmpeg 源代码简单分析 ： av_register_all()
  </h1>
 </div>
 <div class="article-info-box">
  <div class="article-bar-top d-flex">
   <span class="time">
    2013年10月13日 12:41:11
   </span>
   <div ">
    <span class="read-count">
     阅读数：63534
    </span>
   </div>
  </div>
 </div>
 <article>
  <div class="article_content clearfix csdn-tracking-statistics" data-dsm="post" data-mod="popu_307" data-pid="blog" id="article_content">
   <link href="https://csdnimg.cn/release/phoenix/template/css/htmledit_views-0a60691e80.css" rel="stylesheet"/>
   <div class="htmledit_views">
    <p>
    </p>
    <p align="left">
     =====================================================
    </p>
    <p align="left">
     FFmpeg的库函数源代码分析文章列表：
    </p>
    <p align="left">
     【架构图】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44220151" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码结构图 -
      </span>
      <span style="color:blue;">
       解码
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44226355" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码结构图 -
      </span>
      <span style="color:blue;">
       编码
      </span>
     </a>
    </p>
    <p align="left">
     【通用】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12677129" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       av_register_all()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12677265" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avcodec_register_all()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41176777" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：内存的分配和释放（
      </span>
      <span style="color:blue;">
       av_malloc()
      </span>
      <span style="color:blue;">
       、
      </span>
      <span style="color:blue;">
       av_free()
      </span>
      <span style="color:blue;">
       等）
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41181155" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：常见结构体的初始化和销毁（
      </span>
      <span style="color:blue;">
       AVFormatContext
      </span>
      <span style="color:blue;">
       ，
      </span>
      <span style="color:blue;">
       AVFrame
      </span>
      <span style="color:blue;">
       等）
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41199947" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avio_open2()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084557" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       av_find_decoder()
      </span>
      <span style="color:blue;">
       和
      </span>
      <span style="color:blue;">
       av_find_encoder()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44117891" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avcodec_open2()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44206699" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avcodec_close()
      </span>
     </a>
    </p>
    <p align="left">
     【解码】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/8661601" target="_blank">
      <span style="color:blue;">
       图解
      </span>
      <span style="color:blue;">
       FFMPEG
      </span>
      <span style="color:blue;">
       打开媒体的函数
      </span>
      <span style="color:blue;">
       avformat_open_input
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44064715" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avformat_open_input()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084321" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avformat_find_stream_info()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12678577" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       av_read_frame()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12679719" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avcodec_decode_video2()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44110683" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avformat_close_input()
      </span>
     </a>
    </p>
    <p align="left">
     【编码】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41198929" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avformat_alloc_output_context2()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44116215" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avformat_write_header()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44206485" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       avcodec_encode_video()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44199673" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       av_write_frame()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44201645" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       av_write_trailer()
      </span>
     </a>
    </p>
    <p align="left">
     【其它】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44243155" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：日志输出系统（
      </span>
      <span style="color:blue;">
       av_log()
      </span>
      <span style="color:blue;">
       等）
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44268323" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：结构体成员管理系统
      </span>
      <span style="color:blue;">
       -AVClass
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44279329" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：结构体成员管理系统
      </span>
      <span style="color:blue;">
       -AVOption
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44305697" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       libswscale
      </span>
      <span style="color:blue;">
       的
      </span>
      <span style="color:blue;">
       sws_getContext()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44346687" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       libswscale
      </span>
      <span style="color:blue;">
       的
      </span>
      <span style="color:blue;">
       sws_scale()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41211121" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       libavdevice
      </span>
      <span style="color:blue;">
       的
      </span>
      <span style="color:blue;">
       avdevice_register_all()
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44597955" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       libavdevice
      </span>
      <span style="color:blue;">
       的
      </span>
      <span style="color:blue;">
       gdigrab
      </span>
     </a>
    </p>
    <p align="left">
     【脚本】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44556525" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       makefile
      </span>
     </a>
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44587465" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       源代码简单分析：
      </span>
      <span style="color:blue;">
       configure
      </span>
     </a>
    </p>
    <p align="left">
     【H.264】
    </p>
    <p align="left">
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44864509" target="_blank">
      <span style="color:blue;">
       FFmpeg
      </span>
      <span style="color:blue;">
       的
      </span>
      <span style="color:blue;">
       H.264
      </span>
      <span style="color:blue;">
       解码器源代码简单分析：概述
      </span>
     </a>
    </p>
    <p align="left">
     =====================================================
    </p>
    <br/>
    <p>
     前一阵子看了一下ffmpeg的源代码，并且做了一些注释，在此贴出来以作备忘。
    </p>
    <p>
     本文分析一下ffmpeg注册复用器，编码器等的函数av_register_all()。该函数在所有基于ffmpeg的应用程序中几乎都是第一个被调用的。只有调用了该函数，才能使用复用器，编码器等。
    </p>
    <p>
     <br/>
    </p>
    <blockquote style="margin:0px 0px 0px 40px; padding:0px; border:currentColor">
     <p>
      可见
      <strong>
       解复用器
      </strong>
      注册都是用
     </p>
     <p>
      REGISTER_DEMUXER  (X,x)
     </p>
     <p>
      例如：
     </p>
     <p>
      REGISTER_DEMUXER  (AAC, aac)
     </p>
     <p>
      <br/>
     </p>
     <p>
      可见
      <strong>
       复用器
      </strong>
      注册都是用
     </p>
     <p>
      REGISTER_MUXER    (X,x))
     </p>
     <p>
      例如：
     </p>
     <p>
      REGISTER_MUXER    (ADTS, adts)
     </p>
     <p>
      <br/>
     </p>
     <p>
      <strong>
       既有解复用器又有复用器
      </strong>
      的话，可以用
     </p>
     <p>
      REGISTER_MUXDEMUX (X,x));
     </p>
     <p>
      例如：
     </p>
     <p>
      REGISTER_MUXDEMUX (AC3, ac3);
     </p>
    </blockquote>
    <p>
     <br/>
    </p>
    <p>
     我们来看一下宏的定义，这里以
     <strong>
      解复用器
     </strong>
     为例：
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_1_8920609">#define REGISTER_DEMUXER(X,x) { \
    extern AVInputFormat ff_##x##_demuxer; \
    if(CONFIG_##X##_DEMUXER) av_register_input_format(&amp;ff_##x##_demuxer); }</pre>
    <br/>
    <blockquote style="margin:0px 0px 0px 40px; padding:0px; border:currentColor">
     <span style="background-color:rgb(255,255,255)">
      <span style="color:#660000">
       注意：define里面的##可能不太常见，它的含义就是拼接两个字符串，比如
      </span>
     </span>
     <p>
     </p>
     <p>
      <span style="background-color:rgb(255,255,255)">
       <span style="color:#660000">
        #define Conn(x,y) x##y
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:rgb(255,255,255)">
       <span style="color:#660000">
        那么
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:rgb(255,255,255)">
       <span style="color:#660000">
        int  n = Conn(123,456);  结果就是n=123456;
       </span>
      </span>
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     我们以REGISTER_DEMUXER  (AAC, aac)为例，则它等效于
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_2_2145443">extern AVInputFormat ff_aac_demuxer; 
if(CONFIG_AAC_DEMUXER) av_register_input_format(&amp;ff_aac_demuxer); </pre>
    <br/>
    从上面这段代码我们可以看出，真正注册的函数是av_register_input_format(&amp;ff_aac_demuxer)，那我就看看这个和函数的作用，查看一下av_register_input_format()的代码：
    <p>
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_3_9820753">void av_register_input_format(AVInputFormat *format)
{
    AVInputFormat **p;
    p = &amp;first_iformat;
    while (*p != NULL) p = &amp;(*p)-&gt;next;
    *p = format;
    format-&gt;next = NULL;
}</pre>
    <br/>
    这段代码是比较容易理解的，首先先提一点，first_iformat是个什么东东呢？其实它是Input Format链表的头部地址，是一个全局静态变量，定义如下：
    <p>
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_4_1324877">/** head of registered input format linked list */
static AVInputFormat *first_iformat = NULL;</pre>
    由此我们可以分析出av_register_input_format()的含义，一句话概括就是：遍历链表并把当前的Input Format加到链表的尾部。
    <br/>
    至此REGISTER_DEMUXER  (X, x)分析完毕。
    <br/>
    <p>
    </p>
    <p>
     <br/>
    </p>
    <p>
     同理，
     <strong>
      复用器
     </strong>
     道理是一样的，只是注册函数改为av_register_output_format()；
    </p>
    <p>
     <strong>
      既有解复用器又有复用器
     </strong>
     的话，有一个宏定义：
     <br/>
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_5_9141891">#define REGISTER_MUXDEMUX(X,x)  REGISTER_MUXER(X,x); REGISTER_DEMUXER(X,x)</pre>
    <br/>
    可见是分别注册了复用器和解复用器。
    <p>
    </p>
    <p>
     此外还有网络协议的注册，注册函数为ffurl_register_protocol()，在此不再详述。
    </p>
    <p>
     <br/>
    </p>
    <p>
     下面贴出它的源代码（allformats.c）
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_6_3403876">/*
 *雷霄骅
 *leixiaohua1020@126.com
 *中国传媒大学/数字电视技术
 */
/*
 * Register all the formats and protocols
 * Copyright (c) 2000, 2001, 2002 Fabrice Bellard
 *
 * This file is part of FFmpeg.
 *
 * FFmpeg is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * FFmpeg is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with FFmpeg; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
 */
#include "avformat.h"
#include "rtp.h"
#include "rdt.h"
#include "url.h"
//定义的宏？宏的速度会快一点？注册AVOutputFormat
//define中，#用来把参数转换成字符串，##则用来连接前后两个参数，把它们变成一个字符串。
//感觉有点像JAva中的EL，可以随意拼接字符串
#define REGISTER_MUXER(X,x) { \
    extern AVOutputFormat ff_##x##_muxer; \
    if(CONFIG_##X##_MUXER) av_register_output_format(&amp;ff_##x##_muxer); }
//定义的宏？宏的速度会快一点？注册AVInputFormat
#define REGISTER_DEMUXER(X,x) { \
    extern AVInputFormat ff_##x##_demuxer; \
    if(CONFIG_##X##_DEMUXER) av_register_input_format(&amp;ff_##x##_demuxer); }
//注册函数av_register_input_format

//定义的宏？宏的速度会快一点？两个一起注册！
#define REGISTER_MUXDEMUX(X,x)  REGISTER_MUXER(X,x); REGISTER_DEMUXER(X,x)
//定义的宏？宏的速度会快一点？注册URLProtocol
//extern URLProtocol ff_##x##_protocol;
//在librtmp中，对应的就是ff_rtmp_protocol
//这样就把librtmp整合起来了
//由此可见URLProtocol的名字是固定的
#define REGISTER_PROTOCOL(X,x) { \
    extern URLProtocol ff_##x##_protocol; \
    if(CONFIG_##X##_PROTOCOL) ffurl_register_protocol(&amp;ff_##x##_protocol, sizeof(ff_##x##_protocol)); }
//注册函数ffurl_register_protocol
void av_register_all(void)
{
    static int initialized;

    if (initialized)
        return;
    initialized = 1;
    //注册所有的codec
    avcodec_register_all();
    //注册所有的MUXER（复用器和解复用器）
    /* (de)muxers */
    REGISTER_MUXER    (A64, a64);
    REGISTER_DEMUXER  (AAC, aac);
    REGISTER_MUXDEMUX (AC3, ac3);
    REGISTER_DEMUXER  (ACT, act);
    REGISTER_DEMUXER  (ADF, adf);
    REGISTER_MUXER    (ADTS, adts);
    REGISTER_MUXDEMUX (ADX, adx);
    REGISTER_DEMUXER  (AEA, aea);
    REGISTER_MUXDEMUX (AIFF, aiff);
    REGISTER_MUXDEMUX (AMR, amr);
    REGISTER_DEMUXER  (ANM, anm);
    REGISTER_DEMUXER  (APC, apc);
    REGISTER_DEMUXER  (APE, ape);
    REGISTER_DEMUXER  (APPLEHTTP, applehttp);
    REGISTER_MUXDEMUX (ASF, asf);
    REGISTER_MUXDEMUX (ASS, ass);
    REGISTER_MUXER    (ASF_STREAM, asf_stream);
    REGISTER_MUXDEMUX (AU, au);
    REGISTER_MUXDEMUX (AVI, avi);
    REGISTER_DEMUXER  (AVISYNTH, avisynth);
    REGISTER_MUXER    (AVM2, avm2);
    REGISTER_DEMUXER  (AVS, avs);
    REGISTER_DEMUXER  (BETHSOFTVID, bethsoftvid);
    REGISTER_DEMUXER  (BFI, bfi);
    REGISTER_DEMUXER  (BINTEXT, bintext);
    REGISTER_DEMUXER  (BINK, bink);
    REGISTER_MUXDEMUX (BIT, bit);
    REGISTER_DEMUXER  (BMV, bmv);
    REGISTER_DEMUXER  (C93, c93);
    REGISTER_MUXDEMUX (CAF, caf);
    REGISTER_MUXDEMUX (CAVSVIDEO, cavsvideo);
    REGISTER_DEMUXER  (CDG, cdg);
    REGISTER_MUXER    (CRC, crc);
    REGISTER_MUXDEMUX (DAUD, daud);
    REGISTER_DEMUXER  (DFA, dfa);
    REGISTER_MUXDEMUX (DIRAC, dirac);
    REGISTER_MUXDEMUX (DNXHD, dnxhd);
    REGISTER_DEMUXER  (DSICIN, dsicin);
    REGISTER_MUXDEMUX (DTS, dts);
    REGISTER_MUXDEMUX (DV, dv);
    REGISTER_DEMUXER  (DXA, dxa);
    REGISTER_DEMUXER  (EA, ea);
    REGISTER_DEMUXER  (EA_CDATA, ea_cdata);
    REGISTER_MUXDEMUX (EAC3, eac3);
    REGISTER_MUXDEMUX (FFM, ffm);
    REGISTER_MUXDEMUX (FFMETADATA, ffmetadata);
    REGISTER_MUXDEMUX (FILMSTRIP, filmstrip);
    REGISTER_MUXDEMUX (FLAC, flac);
    REGISTER_DEMUXER  (FLIC, flic);
    REGISTER_MUXDEMUX (FLV, flv);
    REGISTER_DEMUXER  (FOURXM, fourxm);
    REGISTER_MUXER    (FRAMECRC, framecrc);
    REGISTER_MUXER    (FRAMEMD5, framemd5);
    REGISTER_MUXDEMUX (G722, g722);
    REGISTER_MUXDEMUX (G723_1, g723_1);
    REGISTER_DEMUXER  (G729, g729);
    REGISTER_MUXER    (GIF, gif);
    REGISTER_DEMUXER  (GSM, gsm);
    REGISTER_MUXDEMUX (GXF, gxf);
    REGISTER_MUXDEMUX (H261, h261);
    REGISTER_MUXDEMUX (H263, h263);
    REGISTER_MUXDEMUX (H264, h264);
    REGISTER_DEMUXER  (ICO, ico);
    REGISTER_DEMUXER  (IDCIN, idcin);
    REGISTER_DEMUXER  (IDF, idf);
    REGISTER_DEMUXER  (IFF, iff);
    REGISTER_MUXDEMUX (IMAGE2, image2);
    REGISTER_MUXDEMUX (IMAGE2PIPE, image2pipe);
    REGISTER_DEMUXER  (INGENIENT, ingenient);
    REGISTER_DEMUXER  (IPMOVIE, ipmovie);
    REGISTER_MUXER    (IPOD, ipod);
    REGISTER_MUXER    (ISMV, ismv);
    REGISTER_DEMUXER  (ISS, iss);
    REGISTER_DEMUXER  (IV8, iv8);
    REGISTER_MUXDEMUX (IVF, ivf);
    REGISTER_DEMUXER  (JV, jv);
    REGISTER_MUXDEMUX (LATM, latm);
    REGISTER_DEMUXER  (LMLM4, lmlm4);
    REGISTER_DEMUXER  (LOAS, loas);
    REGISTER_DEMUXER  (LXF, lxf);
    REGISTER_MUXDEMUX (M4V, m4v);
    REGISTER_MUXER    (MD5, md5);
    REGISTER_MUXDEMUX (MATROSKA, matroska);
    REGISTER_MUXER    (MATROSKA_AUDIO, matroska_audio);
    REGISTER_MUXDEMUX (MICRODVD, microdvd);
    REGISTER_MUXDEMUX (MJPEG, mjpeg);
    REGISTER_MUXDEMUX (MLP, mlp);
    REGISTER_DEMUXER  (MM, mm);
    REGISTER_MUXDEMUX (MMF, mmf);
    REGISTER_MUXDEMUX (MOV, mov);
    REGISTER_MUXER    (MP2, mp2);
    REGISTER_MUXDEMUX (MP3, mp3);
    REGISTER_MUXER    (MP4, mp4);
    REGISTER_DEMUXER  (MPC, mpc);
    REGISTER_DEMUXER  (MPC8, mpc8);
    REGISTER_MUXER    (MPEG1SYSTEM, mpeg1system);
    REGISTER_MUXER    (MPEG1VCD, mpeg1vcd);
    REGISTER_MUXER    (MPEG1VIDEO, mpeg1video);
    REGISTER_MUXER    (MPEG2DVD, mpeg2dvd);
    REGISTER_MUXER    (MPEG2SVCD, mpeg2svcd);
    REGISTER_MUXER    (MPEG2VIDEO, mpeg2video);
    REGISTER_MUXER    (MPEG2VOB, mpeg2vob);
    REGISTER_DEMUXER  (MPEGPS, mpegps);
    REGISTER_MUXDEMUX (MPEGTS, mpegts);
    REGISTER_DEMUXER  (MPEGTSRAW, mpegtsraw);
    REGISTER_DEMUXER  (MPEGVIDEO, mpegvideo);
    REGISTER_MUXER    (MPJPEG, mpjpeg);
    REGISTER_DEMUXER  (MSNWC_TCP, msnwc_tcp);
    REGISTER_DEMUXER  (MTV, mtv);
    REGISTER_DEMUXER  (MVI, mvi);
    REGISTER_MUXDEMUX (MXF, mxf);
    REGISTER_MUXER    (MXF_D10, mxf_d10);
    REGISTER_DEMUXER  (MXG, mxg);
    REGISTER_DEMUXER  (NC, nc);
    REGISTER_DEMUXER  (NSV, nsv);
    REGISTER_MUXER    (NULL, null);
    REGISTER_MUXDEMUX (NUT, nut);
    REGISTER_DEMUXER  (NUV, nuv);
    REGISTER_MUXDEMUX (OGG, ogg);
    REGISTER_MUXDEMUX (OMA, oma);
    REGISTER_MUXDEMUX (PCM_ALAW,  pcm_alaw);
    REGISTER_MUXDEMUX (PCM_MULAW, pcm_mulaw);
    REGISTER_MUXDEMUX (PCM_F64BE, pcm_f64be);
    REGISTER_MUXDEMUX (PCM_F64LE, pcm_f64le);
    REGISTER_MUXDEMUX (PCM_F32BE, pcm_f32be);
    REGISTER_MUXDEMUX (PCM_F32LE, pcm_f32le);
    REGISTER_MUXDEMUX (PCM_S32BE, pcm_s32be);
    REGISTER_MUXDEMUX (PCM_S32LE, pcm_s32le);
    REGISTER_MUXDEMUX (PCM_S24BE, pcm_s24be);
    REGISTER_MUXDEMUX (PCM_S24LE, pcm_s24le);
    REGISTER_MUXDEMUX (PCM_S16BE, pcm_s16be);
    REGISTER_MUXDEMUX (PCM_S16LE, pcm_s16le);
    REGISTER_MUXDEMUX (PCM_S8,    pcm_s8);
    REGISTER_MUXDEMUX (PCM_U32BE, pcm_u32be);
    REGISTER_MUXDEMUX (PCM_U32LE, pcm_u32le);
    REGISTER_MUXDEMUX (PCM_U24BE, pcm_u24be);
    REGISTER_MUXDEMUX (PCM_U24LE, pcm_u24le);
    REGISTER_MUXDEMUX (PCM_U16BE, pcm_u16be);
    REGISTER_MUXDEMUX (PCM_U16LE, pcm_u16le);
    REGISTER_MUXDEMUX (PCM_U8,    pcm_u8);
    REGISTER_DEMUXER  (PMP, pmp);
    REGISTER_MUXER    (PSP, psp);
    REGISTER_DEMUXER  (PVA, pva);
    REGISTER_DEMUXER  (QCP, qcp);
    REGISTER_DEMUXER  (R3D, r3d);
    REGISTER_MUXDEMUX (RAWVIDEO, rawvideo);
    REGISTER_DEMUXER  (RL2, rl2);
    REGISTER_MUXDEMUX (RM, rm);
    REGISTER_MUXDEMUX (ROQ, roq);
    REGISTER_DEMUXER  (RPL, rpl);
    REGISTER_MUXDEMUX (RSO, rso);
    REGISTER_MUXDEMUX (RTP, rtp);
    REGISTER_MUXDEMUX (RTSP, rtsp);
    REGISTER_MUXDEMUX (SAP, sap);
    REGISTER_DEMUXER  (SBG, sbg);
    REGISTER_DEMUXER  (SDP, sdp);
#if CONFIG_RTPDEC
    av_register_rtp_dynamic_payload_handlers();
    av_register_rdt_dynamic_payload_handlers();
#endif
    REGISTER_DEMUXER  (SEGAFILM, segafilm);
    REGISTER_MUXER    (SEGMENT, segment);
    REGISTER_DEMUXER  (SHORTEN, shorten);
    REGISTER_DEMUXER  (SIFF, siff);
    REGISTER_DEMUXER  (SMACKER, smacker);
    REGISTER_MUXDEMUX (SMJPEG, smjpeg);
    REGISTER_DEMUXER  (SOL, sol);
    REGISTER_MUXDEMUX (SOX, sox);
    REGISTER_MUXDEMUX (SPDIF, spdif);
    REGISTER_MUXDEMUX (SRT, srt);
    REGISTER_DEMUXER  (STR, str);
    REGISTER_MUXDEMUX (SWF, swf);
    REGISTER_MUXER    (TG2, tg2);
    REGISTER_MUXER    (TGP, tgp);
    REGISTER_DEMUXER  (THP, thp);
    REGISTER_DEMUXER  (TIERTEXSEQ, tiertexseq);
    REGISTER_MUXER    (MKVTIMESTAMP_V2, mkvtimestamp_v2);
    REGISTER_DEMUXER  (TMV, tmv);
    REGISTER_MUXDEMUX (TRUEHD, truehd);
    REGISTER_DEMUXER  (TTA, tta);
    REGISTER_DEMUXER  (TXD, txd);
    REGISTER_DEMUXER  (TTY, tty);
    REGISTER_DEMUXER  (VC1, vc1);
    REGISTER_MUXDEMUX (VC1T, vc1t);
    REGISTER_DEMUXER  (VMD, vmd);
    REGISTER_MUXDEMUX (VOC, voc);
    REGISTER_DEMUXER  (VQF, vqf);
    REGISTER_DEMUXER  (W64, w64);
    REGISTER_MUXDEMUX (WAV, wav);
    REGISTER_DEMUXER  (WC3, wc3);
    REGISTER_MUXER    (WEBM, webm);
    REGISTER_DEMUXER  (WSAUD, wsaud);
    REGISTER_DEMUXER  (WSVQA, wsvqa);
    REGISTER_MUXDEMUX (WTV, wtv);
    REGISTER_DEMUXER  (WV, wv);
    REGISTER_DEMUXER  (XA, xa);
    REGISTER_DEMUXER  (XBIN, xbin);
    REGISTER_DEMUXER  (XMV, xmv);
    REGISTER_DEMUXER  (XWMA, xwma);
    REGISTER_DEMUXER  (YOP, yop);
    REGISTER_MUXDEMUX (YUV4MPEGPIPE, yuv4mpegpipe);

    /* external libraries */
#if CONFIG_LIBMODPLUG
    REGISTER_DEMUXER  (LIBMODPLUG, libmodplug);
#endif
    REGISTER_MUXDEMUX (LIBNUT, libnut);
    //注册所有的Protocol（位于DEMUXER之前（我的理解~~））
    //文件也是一种Protocol
    /* protocols */
    REGISTER_PROTOCOL (APPLEHTTP, applehttp);
    REGISTER_PROTOCOL (CACHE, cache);
    REGISTER_PROTOCOL (CONCAT, concat);
    REGISTER_PROTOCOL (CRYPTO, crypto);
    REGISTER_PROTOCOL (FILE, file);
    REGISTER_PROTOCOL (GOPHER, gopher);
    REGISTER_PROTOCOL (HTTP, http);
    REGISTER_PROTOCOL (HTTPPROXY, httpproxy);
    REGISTER_PROTOCOL (HTTPS, https);
    REGISTER_PROTOCOL (MMSH, mmsh);
    REGISTER_PROTOCOL (MMST, mmst);
    REGISTER_PROTOCOL (MD5,  md5);
    REGISTER_PROTOCOL (PIPE, pipe);
    REGISTER_PROTOCOL (RTMP, rtmp);
//如果包含了LibRTMP
#if CONFIG_LIBRTMP
    REGISTER_PROTOCOL (RTMP, rtmpt);
    REGISTER_PROTOCOL (RTMP, rtmpe);
    REGISTER_PROTOCOL (RTMP, rtmpte);
    REGISTER_PROTOCOL (RTMP, rtmps);
#endif
    REGISTER_PROTOCOL (RTP, rtp);
    REGISTER_PROTOCOL (TCP, tcp);
    REGISTER_PROTOCOL (TLS, tls);
    REGISTER_PROTOCOL (UDP, udp);
}</pre>
    <br/>
    <br/>
    <p>
     整个代码没太多可说的，首先确定是不是已经初始化过了（initialized），如果没有，就调用avcodec_register_all()注册编解码器（这个先不分析），然后就是注册，注册，注册...直到完成所有注册。
    </p>
    <p>
     PS：曾经研究过一阵子RTMP协议，以及对应的开源工程librtmp。在这里发现有一点值得注意，ffmpeg自带了RTMP协议的支持，只有使用
     <span style="font-family:arial; line-height:18px; font-size:13px">
      rtmpt://, rtmpe://, rtmpte://等的时候才会使用librtmp库。
     </span>
    </p>
    <p>
     <br/>
    </p>
    <p>
     函数调用关系图如下图所示。av_register_all()调用了avcodec_register_all()。avcodec_register_all()注册了和编解码器有关的组件：硬件加速器，解码器，编码器，Parser，Bitstream Filter。av_register_all()除了调用avcodec_register_all()之外，还注册了复用器，解复用器，协议处理器。
    </p>
    <p style="text-align: center;">
     <img alt="" src="http://img.blog.csdn.net/20141109152923350?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"/>
     <br/>
    </p>
    <p>
     下面附上复用器，解复用器，协议处理器的代码。
    </p>
    <p>
     注册复用器的函数是av_register_output_format()。
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_7_2483920">void av_register_output_format(AVOutputFormat *format)
{
    AVOutputFormat **p;
    p = &amp;first_oformat;
    while (*p != NULL) p = &amp;(*p)-&gt;next;
    *p = format;
    format-&gt;next = NULL;
}</pre>
    <br/>
    <p>
    </p>
    <p>
     注册解复用器的函数是av_register_input_format()。
    </p>
    <p>
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_8_5350464">void av_register_input_format(AVInputFormat *format)
{
    AVInputFormat **p;
    p = &amp;first_iformat;
    while (*p != NULL) p = &amp;(*p)-&gt;next;
    *p = format;
    format-&gt;next = NULL;
}</pre>
    <p>
     <br/>
    </p>
    <p>
     注册协议处理器的函数是ffurl_register_protocol()。
    </p>
    <p>
    </p>
    <pre class="cpp" code_snippet_id="513242" name="code" snippet_file_name="blog_20141109_10_9744857">int ffurl_register_protocol(URLProtocol *protocol)
{
    URLProtocol **p;
    p = &amp;first_protocol;
    while (*p)
        p = &amp;(*p)-&gt;next;
    *p             = protocol;
    protocol-&gt;next = NULL;
    return 0;
}</pre>
    <br/>
    <br/>
    <p>
    </p>
   </div>
  </div>
  <div style="display:none;" class="hide-article-box text-center csdn-tracking-statistics tracking-click" data-mod="popu_376">
   <a class="btn btn-red-hollow" id="btn-readmore">
    阅读更多
   </a>
  </div>
 </article>
 <div class="article-bar-bottom">
  <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。			https://blog.csdn.net/leixiaohua1020/article/details/12677129
  </div>
  <div class="tags-box artic-tag-box">
   <span class="label">
    文章标签：
   </span>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=ffmpeg&amp;t=blog" target="_blank">
    ffmpeg
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=源代码&amp;t=blog" target="_blank">
    源代码
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=av_register_all&amp;t=blog" target="_blank">
    av_register_all
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=分析&amp;t=blog" target="_blank">
    分析
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=复用&amp;t=blog" target="_blank">
    复用
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    个人分类：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/leixiaohua1020/article/category/1360795" target="_blank">
    FFMPEG
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    所属专栏：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/column/details/osmedia.html" target="_blank">
    开源多媒体项目源代码分析
   </a>
   <a class="tag-link" href="https://blog.csdn.net/column/details/ffmpeg-devel.html" target="_blank">
    FFmpeg
   </a>
  </div>
 </div>
 <!-- !empty($pre_next_article[0]) -->
</div>
<div class="recommend-box">
                            <div style="background: #fff; border: dashed 1px #666; padding-left: 1em; padding-top: 1em; padding-bottom: 1em;">
                                <span style="font-size: 0.8em; font-weight: bold;">
                                    此PDF由<a style="color:#0000ff" href="http://www.github.com/spygg"  target="_blank">spygg</a>生成,请尊重原作者版权!!!
                                    <br/>
                                    我的邮箱:liushidc@163.com
                                </span>
                                </div> 
                        </div>
                    </main>
      
                </div>

            <script>
                var recommendCount = 0;
                var articleTit = "";
                var articleId = "";
                var commentscount = 0;

                //1禁止评论，2正常
                var commentAuth = 1;
                //百度搜索
                var baiduKey = "";
                var needInsertBaidu = "";
            </script>
            <script src="https://csdnimg.cn/release/phoenix/template/js/detail-effe72036e.min.js"></script>
            </body>
        </html>