
            <!DOCTYPE html>
            <html lang="zh-CN">
                <head>
                    <meta charset="UTF-8">
                    <title>
 FFmpeg源代码结构图 - 解码 - CSDN博客
</title>

                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/detail-60a2c245da.min.css">
                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/themes/skin3-template/skin3-template-88717cedf2.min.css">

                <script type="text/javascript">
                var username = "";
                </script>

                <script src="https://csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>

                <!-- 新版上报 -->
                <!-- 新版上报end -->
                <link rel="stylesheet" href="https://csdnimg.cn/public/sandalstrap/1.3/css/sandalstrap.min.css"> 
                </head>
                <body>    
        
                    <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
                    <div class="container clearfix pt0" id="mainBox">
        <main style="width: 100%;"><div class="blog-content-box">
 <div class="article-title-box" id="article_anchors_82">
  <h1 class="title-article">
   FFmpeg源代码结构图 - 解码
  </h1>
 </div>
 <div class="article-info-box">
  <div class="article-bar-top d-flex">
   <span class="time">
    2015年03月12日 14:03:16
   </span>
   <div ">
    <span class="read-count">
     阅读数：58604
    </span>
   </div>
  </div>
 </div>
 <article>
  <div class="article_content clearfix csdn-tracking-statistics" data-dsm="post" data-mod="popu_307" data-pid="blog" id="article_content">
   <link href="https://csdnimg.cn/release/phoenix/template/css/htmledit_views-0a60691e80.css" rel="stylesheet"/>
   <div class="htmledit_views">
    <p>
    </p>
    <p>
     =====================================================
     <br/>
    </p>
    <p>
     FFmpeg的库函数源代码分析文章列表：
    </p>
    <p>
    </p>
    <p>
     【架构图】
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44220151">
      FFmpeg源代码结构图 - 解码
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44226355">
      FFmpeg源代码结构图 - 编码
     </a>
    </p>
    <p>
     【通用】
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12677129">
      FFmpeg 源代码简单分析：av_register_all()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12677265">
      FFmpeg 源代码简单分析：avcodec_register_all()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41176777">
      FFmpeg 源代码简单分析：内存的分配和释放（av_malloc()、av_free()等）
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41181155">
      FFmpeg 源代码简单分析：常见结构体的初始化和销毁（AVFormatContext，AVFrame等）
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41199947">
      FFmpeg 源代码简单分析：avio_open2()
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084557">
      FFmpeg 源代码简单分析：av_find_decoder()和av_find_encoder()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44117891">
      FFmpeg 源代码简单分析：avcodec_open2()
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44206699">
      FFmpeg 源代码简单分析：avcodec_close()
     </a>
     <br/>
    </p>
    【解码】
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/8661601">
      图解FFMPEG打开媒体的函数avformat_open_input
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44064715">
      FFmpeg 源代码简单分析：avformat_open_input()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084321">
      FFmpeg 源代码简单分析：avformat_find_stream_info()
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12678577">
      FFmpeg 源代码简单分析：av_read_frame()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/12679719">
      FFmpeg 源代码简单分析：avcodec_decode_video2()
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44110683">
      FFmpeg 源代码简单分析：avformat_close_input()
     </a>
    </p>
    <p>
     【编码】
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41198929">
      FFmpeg 源代码简单分析：avformat_alloc_output_context2()
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44116215">
      FFmpeg 源代码简单分析：avformat_write_header()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44206485">
      FFmpeg 源代码简单分析：avcodec_encode_video()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44199673">
      FFmpeg 源代码简单分析：av_write_frame()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44201645">
      FFmpeg 源代码简单分析：av_write_trailer()
     </a>
    </p>
    <p>
     【其它】
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44243155">
      FFmpeg源代码简单分析：日志输出系统（av_log()等）
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44268323">
      FFmpeg源代码简单分析：结构体成员管理系统-AVClass
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44279329">
      FFmpeg源代码简单分析：结构体成员管理系统-AVOption
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44305697">
      FFmpeg源代码简单分析：libswscale的sws_getContext()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44346687">
      FFmpeg源代码简单分析：libswscale的sws_scale()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/41211121">
      FFmpeg源代码简单分析：libavdevice的avdevice_register_all()
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44597955">
      FFmpeg源代码简单分析：libavdevice的gdigrab
     </a>
     <br/>
    </p>
    <p>
     【脚本】
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44556525">
      FFmpeg源代码简单分析：makefile
     </a>
     <br/>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44587465">
      FFmpeg源代码简单分析：configure
     </a>
     <br/>
    </p>
    <p>
     【H.264】
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/44864509">
      FFmpeg的H.264解码器源代码简单分析：概述
     </a>
     <br/>
    </p>
    <p>
     =====================================================
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     近期研究了一下FFmpeg的内部的源代码。之前对于FFmpeg的研究主要在它的应用层面上，因此制作的很多示例程序都是调用的FFmpeg的API。但是一直感觉这样对FFmpeg的理解还是比较浅，所以打算剖析一下它的源代码，理一下它内部结构的“脉络”。但是有一个很难办的问题：FFmpeg自带的三个工程：ffplay， ffmpeg， ffprobe的代码量非常的大，其中包含了成百上千的API；而这些API背后又包含了大量的FFmpeg内部函数。如此一来，几乎是不可能理清他们之间的关系的。经过一番思考之后，打算选择FFmpeg编码和解码过程中的最核心的API进行分析。在编码或者解码的过程中，核心的API数量不多，一共大约10个左右，这样一来就可以剖析其内部的源代码了。
    </p>
    <ul>
     <li>
      FFmpeg解码过程核心的API可以参考：《
      <a href="http://blog.csdn.net/leixiaohua1020/article/details/38868499">
       最简单的基于FFmpeg+SDL的视频播放器
      </a>
      》
     </li>
     <li>
      编码过程核心的API可以参考：《
      <a href="http://blog.csdn.net/leixiaohua1020/article/details/25430425">
       最简单的基于FFmpeg的视频编码器
      </a>
      》
     </li>
    </ul>
    <p>
     <br/>
    </p>
    <h2>
     FFmpeg源代码结构图-解码
    </h2>
    <p>
     首先呈现分析出来的FFmpeg源代码结构图。这张图的尺寸非常的大，尺寸大约有4000x4000，有点像一张地图（因此最好选择“查看更清晰的图片”之后，右键保存图片到本机之后再查看）。它表明了FFmpeg在解码一个视频的时候的函数调用流程。为了保证结构清晰，其中仅列出了最关键的函数，剔除了其它不是特别重要的函数。
    </p>
    <p style="text-align:center;">
     <a href="http://img.my.csdn.net/uploads/201503/12/1426134989_1189.jpg">
      <img alt="" src="https://img-blog.csdn.net/20150312123521828"/>
     </a>
     <br/>
    </p>
    <div style="text-align:center;">
     <a href="https://my.csdn.net/leixiaohua1020/album/detail/1805165">
      单击查看更清晰的图片
     </a>
    </div>
    <br/>
    <p>
     下面解释一下图中关键标记的含义。
    </p>
    <p>
     <br/>
    </p>
    <h3>
     函数背景色
    </h3>
    函数在图中以方框的形式表现出来。不同的背景色标志了该函数不同的作用：
    <br/>
    <ul>
     <li>
      粉红色背景函数：FFmpeg的API函数。
     </li>
     <li>
      白色背景的函数：FFmpeg的内部函数。
     </li>
     <li>
      黄色背景的函数：URLProtocol结构体中的函数，包含处理协议（Protocol）的功能。
     </li>
     <li>
      绿色背景的函数：AVInputFormat结构体中的函数，包含处理封装格式（Format）的功能。
     </li>
     <li>
      蓝色背景的函数：AVCodec结构体中的函数，包含了编解码器（Codec）的功能。
     </li>
    </ul>
    <span style="font-family:'FangSong_GB2312';">
     PS：URLProtocol，AVInputFormat，AVCodec在FFmpeg开始运行并且注册完组件之后，都会分别被连接成一个个的链表。因此实际上是有很多的URLProtocol，AVInputFormat，AVCodec的。图中画出了解码一个输入协议是“文件”（其实就是打开一个文件。“文件”也被当做是一种广义的协议），封装格式为FLV，视频编码格式是H.264的数据的函数调用关系。
    </span>
    <br/>
    <br/>
    <h3>
     区域
    </h3>
    整个架构图可以分为以下几个区域：
    <br/>
    <ul>
     <li>
      左边区域——架构函数区域：这些函数并不针对某一特定的视频格式。
     </li>
     <li>
      右上方黄色区域——协议处理函数区域：不同的协议（RTP，RTMP，FILE）会调用不同的协议处理函数。
     </li>
     <li>
      右边中间绿色区域——封装格式处理函数区域：不同的封装格式（MKV，FLV，MPEGTS，AVI）会调用不同的封装格式处理函数。
     </li>
     <li>
      右边下方蓝色区域——编解码函数区域：不同的编码标准（HEVC，H.264，MPEG2）会调用不同的编解码函数。
     </li>
    </ul>
    <p>
     <br/>
    </p>
    <h3>
     箭头线
    </h3>
    <p>
     为了把调用关系表示的更明显，图中的箭头线也使用了不同的颜色：
    </p>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      黑色箭头线：标志了函数之间的调用关系。
     </p>
     <p>
      红色的箭头线：标志了解码的流程。
     </p>
     <p>
      其他颜色的箭头线：标志了函数之间的调用关系。其中：
     </p>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       调用URLProtocol结构体中的函数用黄色箭头线标识；
      </p>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       调用AVInputFormat结构体中的函数用绿色箭头线标识；
      </p>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      调用AVCodec结构体中的函数用蓝色箭头线标识。
     </blockquote>
    </blockquote>
    <p>
     <br/>
    </p>
    <h3>
     函数所在的文件
    </h3>
    <p>
     每个函数旁边标识了它所在的文件的路径。
    </p>
    <p>
     <br/>
    </p>
    此外，还有一点需要注意的是，一些API函数内部也调用了另一些API函数。也就是说，API函数并不一定全部都调用FFmpeg的内部函数，他也有可能调用其他的API函数。例如从图中可以看出来，avformat_close_input()调用了avformat_free_context()和avio_close()。这些在内部代码中被调用的API函数也标记为粉红色。
    <br/>
    <br/>
    <h2>
     函数调用关系
    </h2>
    下面简单列出几个区域中函数之间的调用关系（函数之间的调用关系使用缩进的方式表现出来）。详细的函数分析可以参考相关的《FFmpeg源代码分析》系列文章。
    <br/>
    <p>
     <br/>
    </p>
    <h3>
     左边区域（FFmpeg架构函数）
    </h3>
    <p>
     <br/>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       1.
      </span>
      <span style="color:#FF0000;">
       av_register_all()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/12677129">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      <strong>
       <span style="color:#FF0000;">
        1)
       </span>
       <span style="color:#FF0000;">
        avcodec_register_all()
       </span>
      </strong>
     </p>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (a) REGISTER_HWACCEL()
       </strong>
      </p>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (b) REGISTER_ENCODER()
       </strong>
      </p>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (c) REGISTER_DECODER()
       </strong>
      </p>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (d) REGISTER_PARSER()
       </strong>
      </p>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (e) REGISTER_BSF()
       </strong>
      </p>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      <strong>
       2)  REGISTER_MUXER()
      </strong>
     </p>
     <p>
      <strong>
       3)  REGISTER_DEMUXER()
      </strong>
     </p>
     <p>
      <strong>
       4)  REGISTER_PROTOCOL()
      </strong>
     </p>
    </blockquote>
    <p>
     <strong>
      <span style="color:#FF0000;">
       2.
      </span>
      <span style="color:#FF0000;">
       avformat_alloc_context()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/41181155">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      <strong>
       1) av_malloc(sizeof(AVFormatContext))
      </strong>
     </p>
     <p>
      <strong>
       2) avformat_get_context_defaults()
      </strong>
     </p>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        (a) av_opt_set_defaults()
       </strong>
      </p>
     </blockquote>
    </blockquote>
    <p>
     <strong>
      <span style="color:#FF0000;">
       3.
      </span>
      <span style="color:#FF0000;">
       avformat_open_input()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44064715">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      <strong>
       1) init_input()
      </strong>
     </p>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
       <strong>
        <span style="color:#FF0000;">
         (a)
        </span>
        <span style="color:#FF0000;">
         avio_open2()
         <span style="color:rgb(255,0,0);">
          <strong>
           【
           <a href="http://blog.csdn.net/leixiaohua1020/article/details/41199947">
            函数简单分析
           </a>
           】
          </strong>
         </span>
        </span>
       </strong>
      </p>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <p>
        <strong>
         a) ffurl_open()
        </strong>
       </p>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <p>
         <strong>
          i. ffurl_alloc()
         </strong>
        </p>
       </blockquote>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
         <p>
          l
          <strong>
           url_find_protocol()
          </strong>
         </p>
        </blockquote>
       </blockquote>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
         <p>
          l
          <strong>
           url_alloc_for_protocol()
          </strong>
         </p>
        </blockquote>
       </blockquote>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <p>
         <strong>
          ii. ffurl_connect()
         </strong>
        </p>
       </blockquote>
      </blockquote>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
         <p>
          <strong>
           <span style="color:#FFC000;">
            URLProtocol-&gt;url_open()
           </span>
          </strong>
         </p>
        </blockquote>
       </blockquote>
      </blockquote>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <p>
        <strong>
         b) ffio_fdopen()
        </strong>
       </p>
      </blockquote>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <p>
         <strong>
          i. av_malloc(buffer_size)
         </strong>
        </p>
       </blockquote>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <p>
         <strong>
          ii.
          <span style="color:#FF0000;">
           avio_alloc_context()
          </span>
         </strong>
        </p>
       </blockquote>
      </blockquote>
     </blockquote>
    </blockquote>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
         <p>
          l
          <strong>
           av_mallocz(sizeof(AVIOContext))
          </strong>
         </p>
        </blockquote>
       </blockquote>
      </blockquote>
     </blockquote>
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
       <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
        <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
         <p>
          l
          <strong>
           ffio_init_context()
          </strong>
         </p>
        </blockquote>
       </blockquote>
      </blockquote>
     </blockquote>
    </blockquote>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       (b)
      </span>
      <span style="color:#FF0000;">
       av_probe_input_buffer2()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       a)
      </span>
      <span style="color:#FF0000;">
       avio_read()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      i.
      <span style="color:#00B050;">
       AVInputFormat-&gt;read_packet()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       b)
      </span>
      <span style="color:#FF0000;">
       av_probe_input_format2()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       c)
      </span>
      <span style="color:#FF0000;">
       av_probe_input_format3()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      i.
      <span style="color:#FF0000;">
       av_iformat_next()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      ii.
      <span style="color:#FF0000;">
       av_match_name()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      iii.
      <span style="color:#FF0000;">
       av_match_ext()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      iv.
      <span style="color:#00B050;">
       AVInputFormat-&gt;read_probe()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#009900;">
       <span style="white-space:pre;">
       </span>
       2) AVInputFormat-&gt;read_header()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       4.
      </span>
      <span style="color:#FF0000;">
       avformat_find_stream_info()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084321">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      1) find_decoder()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       (a)
      </span>
      <span style="color:#FF0000;">
       avcodec_find_decoder()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       2)
      </span>
      <span style="color:#FF0000;">
       avcodec_open2()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      3) read_frame_internal()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      4) try_decode_frame()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       (a)
      </span>
      <span style="color:#FF0000;">
       avcodec_decode_video2()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       <span style="white-space:pre;">
       </span>
       5)
      </span>
      <span style="color:#FF0000;">
       avcodec_close()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      6) estimate_timings()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (a)  estimate_timings_from_pts()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (b)  estimate_timings_from_bit_rate()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (c)  update_stream_timings()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       5.
      </span>
      <span style="color:#FF0000;">
       avcodec_find_decoder()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44084557">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      1) find_encdec()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       6.
      </span>
      <span style="color:#FF0000;">
       avcodec_open2()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44117891">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#3072C2;">
       <span style="white-space:pre;">
       </span>
       1)
      </span>
      <span style="color:#3072C2;">
       AVCodec-&gt;init()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       7.
      </span>
      <span style="color:#FF0000;">
       av_read_frame()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/12678577">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      1) read_from_packet_buffer()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      2) read_frame_internal()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (a) ff_read_packet()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#00B050;">
       <span style="white-space:pre;">
       </span>
       a)
      </span>
      <span style="color:#00B050;">
       AVInputFormat-&gt;read_packet()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (b) parse_packet()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      a) av_parser_parse2()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       8.
      </span>
      <span style="color:#FF0000;">
       avcodec_decode_video2()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/12679719">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      1) av_packet_split_side_data()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#3072C2;">
       <span style="white-space:pre;">
       </span>
       2)
      </span>
      <span style="color:#3072C2;">
       AVCodec-&gt;
      </span>
     </strong>
     <span style="color:#3072C2;">
      <strong>
       decode()
      </strong>
     </span>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      3) av_frame_set_pkt_pos()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      4) av_frame_set_best_effort_timestamp()
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       9.
      </span>
      <span style="color:#FF0000;">
       avcodec_close()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44206699">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#3072C2;">
       <span style="white-space:pre;">
       </span>
       1)
      </span>
      <span style="color:#3072C2;">
       AVCodec-&gt;close()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#FF0000;">
       10.
      </span>
      <span style="color:#FF0000;">
       avformat_close_input()
      </span>
      <span style="color:#FF0000;">
       【
       <a href="http://blog.csdn.net/leixiaohua1020/article/details/44110683">
        函数简单分析
       </a>
       】
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#00B050;">
       <span style="white-space:pre;">
       </span>
       1)
      </span>
      <span style="color:#00B050;">
       AVInputFormat-&gt;read_close()
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      2) avformat_free_context()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (a) ff_free_stream()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      3) avio_close()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (a) avio_flush()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      a) flush_buffer()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      (b) ffurl_close()
     </strong>
    </p>
    <p>
     <strong>
      <span style="white-space:pre;">
      </span>
      a) ffurl_closep()
     </strong>
    </p>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
      <p>
      </p>
      <p>
       <strong>
        <span style="color:rgb(255,192,0);">
         <strong>
          <span style="white-space:pre;">
          </span>
          URLProtocol-&gt;url_close()
         </strong>
        </span>
       </strong>
      </p>
     </blockquote>
    </blockquote>
    <p>
     <br/>
    </p>
    <h3>
     右上区域（URLProtocol协议处理函数）
    </h3>
    URLProtocol结构体包含如下协议处理函数指针：
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <span style="color:#ffcc33;">
      <strong>
       url_open()：打开
       <br/>
      </strong>
     </span>
     <span style="color:#ffcc33;">
      <strong>
       url_read()：读取
       <br/>
      </strong>
     </span>
     <span style="color:#ffcc33;">
      <strong>
       url_write()：写入
       <br/>
      </strong>
     </span>
     <span style="color:#ffcc33;">
      <strong>
       url_seek()：调整进度
       <br/>
      </strong>
     </span>
     <span style="color:#ffcc33;">
      <strong>
       url_close()：关闭
      </strong>
     </span>
    </blockquote>
    <p>
     <br/>
    </p>
    <p>
     【例子】不同的协议对应着上述接口有不同的实现函数，举几个例子：
    </p>
    <strong>
     File协议（即文件）对应的URLProtocol结构体ff_file_protocol：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     url_open() -&gt; file_open() -&gt; open()
     <br/>
     url_read() -&gt; file_read() -&gt; read()
     <br/>
     url_write() -&gt; file_write() -&gt; write()
     <br/>
     url_seek() -&gt; file_seek() -&gt; lseek()
     <br/>
     url_close() -&gt; file_close() -&gt; close()
    </blockquote>
    <strong>
     RTMP协议（libRTMP）对应的URLProtocol结构体ff_librtmp_protocol：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     url_open() -&gt; rtmp_open() -&gt; RTMP_Init(), RTMP_SetupURL(), RTMP_Connect(), RTMP_ConnectStream()
     <br/>
     url_read() -&gt; rtmp_read() -&gt; RTMP_Read()
     <br/>
     url_write() -&gt; rtmp_write() -&gt; RTMP_Write()
     <br/>
     url_seek() -&gt; rtmp_read_seek() -&gt; RTMP_SendSeek()
     <br/>
     url_close() -&gt; rtmp_close() -&gt; RTMP_Close()
    </blockquote>
    <strong>
     UDP协议对应的URLProtocol结构体ff_udp_protocol：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     url_open() -&gt; udp_open()
     <br/>
     url_read() -&gt; udp_read()
     <br/>
     url_write() -&gt; udp_write()
     <br/>
     url_seek() -&gt; udp_close()
     <p>
      url_close() -&gt; udp_close()
     </p>
    </blockquote>
    <p>
     <br/>
    </p>
    <h3>
     右中区域（AVInputFormat封装格式处理函数）
    </h3>
    AVInputFormat包含如下封装格式处理函数指针：
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <strong>
      <span style="color:#33cc00;">
       read_probe()：检查格式
       <br/>
      </span>
      <span style="color:#33cc00;">
       read_header()：读取文件头
       <br/>
      </span>
      <span style="color:#33cc00;">
       read_packet()：读取一帧数据
       <br/>
      </span>
      <span style="color:#33cc00;">
       read_seek()：调整进度
       <br/>
      </span>
      <span style="color:#33cc00;">
       read_close()：关闭
      </span>
     </strong>
    </blockquote>
    <p>
     <br/>
    </p>
    <p>
     【例子】不同的封装格式对应着上述接口有不同的实现函数，举几个例子：
    </p>
    <strong>
     FLV封装格式对应的AVInputFormat结构体ff_flv_demuxer：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     read_probe() -&gt; flv_probe() –&gt; probe()
     <br/>
     read_header() -&gt; flv_read_header() -&gt; create_stream() -&gt; avformat_new_stream()
     <br/>
     read_packet() -&gt; flv_read_packet()
     <br/>
     read_seek() -&gt; flv_read_seek()
     <br/>
     read_close() -&gt; flv_read_close()
    </blockquote>
    <strong>
     MKV封装格式对应的AVInputFormat结构体ff_matroska_demuxer：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     read_probe() -&gt; matroska_probe()
     <br/>
     read_header() -&gt; matroska_read_header()
     <br/>
     read_packet() -&gt; matroska_read_packet()
     <br/>
     read_seek() -&gt; matroska_read_seek()
     <br/>
     read_close() -&gt; matroska_read_close()
    </blockquote>
    <strong>
     MPEG2TS封装格式对应的AVInputFormat结构体ff_mpegts_demuxer：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     read_probe() -&gt; mpegts_probe()
     <br/>
     read_header() -&gt; mpegts_read_header()
     <br/>
     read_packet() -&gt; mpegts_read_packet()
     <br/>
     read_close() -&gt; mpegts_read_close()
    </blockquote>
    <strong>
     AVI封装格式对应的AVInputFormat结构体ff_avi_demuxer：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     read_probe() -&gt; avi_probe()
     <br/>
     read_header() -&gt; avi_read_header()
     <br/>
     read_packet() -&gt; avi_read_packet()
     <br/>
     read_seek() -&gt; avi_read_seek()
     <br/>
     read_close() -&gt; avi_read_close()
    </blockquote>
    <br/>
    <h3>
     右下区域（AVCodec编解码函数）
    </h3>
    AVCodec包含如下编解码函数指针：
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <strong>
      <span style="color:#3333ff;">
       init()：初始化
       <br/>
      </span>
      <span style="color:#3333ff;">
       decode()：解码一帧数据
       <br/>
      </span>
      <span style="color:#3333ff;">
       close()：关闭
      </span>
     </strong>
    </blockquote>
    <p>
     <br/>
    </p>
    <p>
     【例子】不同的编解码器对应着上述接口有不同的实现函数，举几个例子：
    </p>
    <strong>
     HEVC解码对应的AVCodec结构体ff_hevc_decoder：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     init() -&gt; hevc_decode_init()
     <br/>
     decode() -&gt; hevc_decode_frame() -&gt; decode_nal_units()
     <br/>
     close() -&gt; hevc_decode_free()
    </blockquote>
    <strong>
     H.264解码对应的AVCodec结构体ff_h264_decoder：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     init() -&gt; ff_h264_decode_init()
     <br/>
     decode() -&gt; h264_decode_frame() -&gt; decode_nal_units()
     <br/>
     close() -&gt; h264_decode_end()
    </blockquote>
    <strong>
     VP8解码（libVPX）对应的AVCodec结构体ff_libvpx_vp8_decoder：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     init() -&gt; vpx_init() -&gt; vpx_codec_dec_init()
     <br/>
     decode() -&gt; vp8_decode() -&gt; vpx_codec_decode(), vpx_codec_get_frame()
     <br/>
     close() -&gt; vp8_free() -&gt; vpx_codec_destroy()
    </blockquote>
    <strong>
     MPEG2解码对应的AVCodec结构体ff_mpeg2video_decoder：
    </strong>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     init() -&gt; mpeg_decode_init()
     <br/>
     decode() -&gt; mpeg_decode_frame()
     <br/>
     <p>
      close() -&gt; mpeg_decode_end()
     </p>
    </blockquote>
    <br/>
    <blockquote style="margin:0 0 0 40px;border:none;padding:0px;">
     <p>
      <br/>
     </p>
    </blockquote>
    <p>
     <span style="color:#990000;">
      <strong>
       雷霄骅 (Lei Xiaohua)
       <br/>
       leixiaohua1020@126.com
       <br/>
       http://blog.csdn.net/leixiaohua1020
      </strong>
     </span>
     <br/>
    </p>
    <p>
     <br/>
    </p>
   </div>
  </div>
  <div style="display:none;" class="hide-article-box text-center csdn-tracking-statistics tracking-click" data-mod="popu_376">
   <a class="btn btn-red-hollow" id="btn-readmore">
    阅读更多
   </a>
  </div>
 </article>
 <div class="article-bar-bottom">
  <div class="tags-box artic-tag-box">
   <span class="label">
    文章标签：
   </span>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=FFmpeg&amp;t=blog" target="_blank">
    FFmpeg
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=解码&amp;t=blog" target="_blank">
    解码
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=架构&amp;t=blog" target="_blank">
    架构
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=函数&amp;t=blog" target="_blank">
    函数
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    个人分类：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/leixiaohua1020/article/category/1360795" target="_blank">
    FFMPEG
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    所属专栏：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/column/details/ffmpeg-devel.html" target="_blank">
    FFmpeg
   </a>
  </div>
 </div>
 <!-- !empty($pre_next_article[0]) -->
</div>
<div class="recommend-box">
                            <div style="background: #fff; border: dashed 1px #666; padding-left: 1em; padding-top: 1em; padding-bottom: 1em;">
                                <span style="font-size: 0.8em; font-weight: bold;">
                                    此PDF由<a style="color:#0000ff" href="http://www.github.com/spygg"  target="_blank">spygg</a>生成,请尊重原作者版权!!!
                                    <br/>
                                    我的邮箱:liushidc@163.com
                                </span>
                                </div> 
                        </div>
                    </main>
      
                </div>

            <script>
                var recommendCount = 0;
                var articleTit = "";
                var articleId = "";
                var commentscount = 0;

                //1禁止评论，2正常
                var commentAuth = 1;
                //百度搜索
                var baiduKey = "";
                var needInsertBaidu = "";
            </script>
            <script src="https://csdnimg.cn/release/phoenix/template/js/detail-effe72036e.min.js"></script>
            </body>
        </html>