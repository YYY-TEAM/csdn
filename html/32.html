
            <!DOCTYPE html>
            <html lang="zh-CN">
                <head>
                    <meta charset="UTF-8">
                    <title>
 最简单的基于FFmpeg的移动端例子：IOS 视频解码器 - CSDN博客
</title>

                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/detail-60a2c245da.min.css">
                <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/themes/skin3-template/skin3-template-88717cedf2.min.css">

                <script type="text/javascript">
                var username = "";
                </script>

                <script src="https://csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>

                <!-- 新版上报 -->
                <!-- 新版上报end -->
                <link rel="stylesheet" href="https://csdnimg.cn/public/sandalstrap/1.3/css/sandalstrap.min.css"> 
                </head>
                <body>    
        
                    <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
                    <div class="container clearfix pt0" id="mainBox">
        <main style="width: 100%;"><div class="blog-content-box">
 <div class="article-title-box" id="article_anchors_32">
  <span class="article-type type-1 float-left">
   原
  </span>
  <h1 class="title-article">
   最简单的基于FFmpeg的移动端例子：IOS 视频解码器
  </h1>
 </div>
 <div class="article-info-box">
  <div class="article-bar-top d-flex">
   <span class="time">
    2015年07月28日 19:02:45
   </span>
   <div ">
    <span class="read-count">
     阅读数：26020
    </span>
   </div>
  </div>
 </div>
 <article>
  <div class="article_content clearfix csdn-tracking-statistics" data-dsm="post" data-mod="popu_307" data-pid="blog" id="article_content">
   <link href="https://csdnimg.cn/release/phoenix/template/css/htmledit_views-0a60691e80.css" rel="stylesheet"/>
   <div class="htmledit_views">
    <p>
    </p>
    <p>
     =====================================================
    </p>
    <p>
     最简单的基于FFmpeg的移动端例子系列文章列表：
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47008825">
      最简单的基于FFmpeg的移动端例子：Android HelloWorld
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47010637">
      最简单的基于FFmpeg的移动端例子：Android 视频解码器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47011021">
      最简单的基于FFmpeg的移动端例子：Android 视频解码器-单个库版
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47056051">
      最简单的基于FFmpeg的移动端例子：Android 推流器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47056365">
      最简单的基于FFmpeg的移动端例子：Android 视频转码器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47056733">
      最简单的基于FFmpeg的移动端例子附件：Android 自带播放器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47059553">
      最简单的基于FFmpeg的移动端例子附件：SDL Android HelloWorld
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47071547">
      最简单的基于FFmpeg的移动端例子：IOS HelloWorld
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47072257">
      最简单的基于FFmpeg的移动端例子：IOS 视频解码器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47072519">
      最简单的基于FFmpeg的移动端例子：IOS 推流器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47072673">
      最简单的基于FFmpeg的移动端例子：IOS 视频转码器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47072861">
      最简单的基于FFmpeg的移动端例子附件：IOS自带播放器
     </a>
    </p>
    <p>
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/47191283">
      最简单的基于FFmpeg的移动端例子：Windows Phone HelloWorld
     </a>
    </p>
    <p>
     =====================================================
    </p>
    <br/>
    <p>
     本文记录IOS平台下基于FFmpeg的视频解码器。该示例C语言的源代码来自于《
     <a href="http://blog.csdn.net/leixiaohua1020/article/details/38868499">
      最简单的基于FFMPEG+SDL的视频播放器
     </a>
     》。相关的概念就不再重复记录了。
    </p>
    <p style="text-align:center;">
     <img alt="" src="https://img-blog.csdn.net/20150801182747903"/>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <h2>
     源代码
    </h2>
    <p>
     项目的目录结构如图所示。
    </p>
    <p style="text-align:center;">
     <img alt="" src="https://img-blog.csdn.net/20150726214420710"/>
     <br/>
    </p>
    C代码位于ViewController.m文件中，内容如下所示。
    <pre class="cpp">/**
 * 最简单的基于FFmpeg的视频解码器-IOS
 * Simplest FFmpeg IOS Decoder
 *
 * 雷霄骅 Lei Xiaohua
 * leixiaohua1020@126.com
 * 中国传媒大学/数字电视技术
 * Communication University of China / Digital TV Technology
 * http://blog.csdn.net/leixiaohua1020
 *
 * 本程序是IOS平台下最简单的基于FFmpeg的视频解码器。
 * 它可以将输入的视频数据解码成YUV像素数据。
 *
 * This software is the simplest decoder based on FFmpeg in IOS.
 * It can decode video stream to raw YUV data.
 *
 */

#import "ViewController.h"
#include &lt;libavcodec/avcodec.h&gt;
#include &lt;libavformat/avformat.h&gt;
#include &lt;libavutil/imgutils.h&gt;
#include &lt;libswscale/swscale.h&gt;

@interface ViewController ()

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (IBAction)clickDecodeButton:(id)sender {
    AVFormatContext	*pFormatCtx;
    int				i, videoindex;
    AVCodecContext	*pCodecCtx;
    AVCodec			*pCodec;
    AVFrame	*pFrame,*pFrameYUV;
    uint8_t *out_buffer;
    AVPacket *packet;
    int y_size;
    int ret, got_picture;
    struct SwsContext *img_convert_ctx;
    FILE *fp_yuv;
    int frame_cnt;
    clock_t time_start, time_finish;
    double  time_duration = 0.0;
    
    char input_str_full[500]={0};
    char output_str_full[500]={0};
    char info[1000]={0};
    
    NSString *input_str= [NSString stringWithFormat:@"resource.bundle/%@",self.inputurl.text];
    NSString *output_str= [NSString stringWithFormat:@"resource.bundle/%@",self.outputurl.text];
    
    NSString *input_nsstr=[[[NSBundle mainBundle]resourcePath] stringByAppendingPathComponent:input_str];
    NSString *output_nsstr=[[[NSBundle mainBundle]resourcePath] stringByAppendingPathComponent:output_str];
    
    sprintf(input_str_full,"%s",[input_nsstr UTF8String]);
    sprintf(output_str_full,"%s",[output_nsstr UTF8String]);
    
    printf("Input Path:%s\n",input_str_full);
    printf("Output Path:%s\n",output_str_full);
    
    av_register_all();
    avformat_network_init();
    pFormatCtx = avformat_alloc_context();
    
    if(avformat_open_input(&amp;pFormatCtx,input_str_full,NULL,NULL)!=0){
        printf("Couldn't open input stream.\n");
        return ;
    }
    if(avformat_find_stream_info(pFormatCtx,NULL)&lt;0){
        printf("Couldn't find stream information.\n");
        return;
    }
    videoindex=-1;
    for(i=0; i&lt;pFormatCtx-&gt;nb_streams; i++)
        if(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO){
            videoindex=i;
            break;
        }
    if(videoindex==-1){
        printf("Couldn't find a video stream.\n");
        return;
    }
    pCodecCtx=pFormatCtx-&gt;streams[videoindex]-&gt;codec;
    pCodec=avcodec_find_decoder(pCodecCtx-&gt;codec_id);
    if(pCodec==NULL){
        printf("Couldn't find Codec.\n");
        return;
    }
    if(avcodec_open2(pCodecCtx, pCodec,NULL)&lt;0){
        printf("Couldn't open codec.\n");
        return;
    }
    
    pFrame=av_frame_alloc();
    pFrameYUV=av_frame_alloc();
    out_buffer=(unsigned char *)av_malloc(av_image_get_buffer_size(AV_PIX_FMT_YUV420P,  pCodecCtx-&gt;width, pCodecCtx-&gt;height,1));
    av_image_fill_arrays(pFrameYUV-&gt;data, pFrameYUV-&gt;linesize,out_buffer,
                         AV_PIX_FMT_YUV420P,pCodecCtx-&gt;width, pCodecCtx-&gt;height,1);
    packet=(AVPacket *)av_malloc(sizeof(AVPacket));
    
    img_convert_ctx = sws_getContext(pCodecCtx-&gt;width, pCodecCtx-&gt;height, pCodecCtx-&gt;pix_fmt,
                                     pCodecCtx-&gt;width, pCodecCtx-&gt;height, AV_PIX_FMT_YUV420P, SWS_BICUBIC, NULL, NULL, NULL);
    
    
    sprintf(info,   "[Input     ]%s\n", [input_str UTF8String]);
    sprintf(info, "%s[Output    ]%s\n",info,[output_str UTF8String]);
    sprintf(info, "%s[Format    ]%s\n",info, pFormatCtx-&gt;iformat-&gt;name);
    sprintf(info, "%s[Codec     ]%s\n",info, pCodecCtx-&gt;codec-&gt;name);
    sprintf(info, "%s[Resolution]%dx%d\n",info, pCodecCtx-&gt;width,pCodecCtx-&gt;height);
    
    
    fp_yuv=fopen(output_str_full,"wb+");
    if(fp_yuv==NULL){
        printf("Cannot open output file.\n");
        return;
    }
    
    frame_cnt=0;
    time_start = clock();
    
    while(av_read_frame(pFormatCtx, packet)&gt;=0){
        if(packet-&gt;stream_index==videoindex){
            ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;got_picture, packet);
            if(ret &lt; 0){
                printf("Decode Error.\n");
                return;
            }
            if(got_picture){
                sws_scale(img_convert_ctx, (const uint8_t* const*)pFrame-&gt;data, pFrame-&gt;linesize, 0, pCodecCtx-&gt;height,
                          pFrameYUV-&gt;data, pFrameYUV-&gt;linesize);
                
                y_size=pCodecCtx-&gt;width*pCodecCtx-&gt;height;
                fwrite(pFrameYUV-&gt;data[0],1,y_size,fp_yuv);    //Y
                fwrite(pFrameYUV-&gt;data[1],1,y_size/4,fp_yuv);  //U
                fwrite(pFrameYUV-&gt;data[2],1,y_size/4,fp_yuv);  //V
                //Output info
                char pictype_str[10]={0};
                switch(pFrame-&gt;pict_type){
                    case AV_PICTURE_TYPE_I:sprintf(pictype_str,"I");break;
                    case AV_PICTURE_TYPE_P:sprintf(pictype_str,"P");break;
                    case AV_PICTURE_TYPE_B:sprintf(pictype_str,"B");break;
                    default:sprintf(pictype_str,"Other");break;
                }
                printf("Frame Index: %5d. Type:%s\n",frame_cnt,pictype_str);
                frame_cnt++;
            }
        }
        av_free_packet(packet);
    }
    //flush decoder
    //FIX: Flush Frames remained in Codec
    while (1) {
        ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;got_picture, packet);
        if (ret &lt; 0)
            break;
        if (!got_picture)
            break;
        sws_scale(img_convert_ctx, (const uint8_t* const*)pFrame-&gt;data, pFrame-&gt;linesize, 0, pCodecCtx-&gt;height,
                  pFrameYUV-&gt;data, pFrameYUV-&gt;linesize);
        int y_size=pCodecCtx-&gt;width*pCodecCtx-&gt;height;
        fwrite(pFrameYUV-&gt;data[0],1,y_size,fp_yuv);    //Y
        fwrite(pFrameYUV-&gt;data[1],1,y_size/4,fp_yuv);  //U
        fwrite(pFrameYUV-&gt;data[2],1,y_size/4,fp_yuv);  //V
        //Output info
        char pictype_str[10]={0};
        switch(pFrame-&gt;pict_type){
            case AV_PICTURE_TYPE_I:sprintf(pictype_str,"I");break;
            case AV_PICTURE_TYPE_P:sprintf(pictype_str,"P");break;
            case AV_PICTURE_TYPE_B:sprintf(pictype_str,"B");break;
            default:sprintf(pictype_str,"Other");break;
        }
        printf("Frame Index: %5d. Type:%s\n",frame_cnt,pictype_str);
        frame_cnt++;
    }
    time_finish = clock(); 
    time_duration=(double)(time_finish - time_start);
    
    sprintf(info, "%s[Time      ]%fus\n",info,time_duration);
    sprintf(info, "%s[Count     ]%d\n",info,frame_cnt);
    
    sws_freeContext(img_convert_ctx);
    
    fclose(fp_yuv);
    
    av_frame_free(&amp;pFrameYUV);
    av_frame_free(&amp;pFrame);
    avcodec_close(pCodecCtx);
    avformat_close_input(&amp;pFormatCtx);
    
    NSString * info_ns = [NSString stringWithFormat:@"%s", info];
    self.infomation.text=info_ns;

}


@end
</pre>
    <p class="objc">
    </p>
    <p>
     <br/>
    </p>
    <h2>
     运行结果
    </h2>
    <p>
     App在手机上运行后的结果如下图所示。单击“Decode”，将会把位于resource.bundle中的“sintel.mov”文件解码为“sintel.yuv”文件并存储于相同的目录下。
    </p>
    <p style="text-align:center;">
     <img alt="" src="https://img-blog.csdn.net/20150726214424559"/>
     <br/>
    </p>
    生成的文件如下图所示。
    <br/>
    <div style="text-align:center;">
     <img alt="" src="https://img-blog.csdn.net/20150726214440783"/>
    </div>
    <br/>
    <h2>
     下载
    </h2>
    <br/>
    <strong>
     simplest ffmpeg mobile
    </strong>
    <br/>
    <br/>
    <p>
     <strong>
      项目主页
     </strong>
    </p>
    <p>
     Github：
     <a href="https://github.com/leixiaohua1020/simplest_ffmpeg_mobile">
      https://github.com/leixiaohua1020/simplest_ffmpeg_mobile
     </a>
    </p>
    <p>
     开源中国：
     <a href="https://git.oschina.net/leixiaohua1020/simplest_ffmpeg_mobile">
      https://git.oschina.net/leixiaohua1020/simplest_ffmpeg_mobile
      <br/>
     </a>
    </p>
    <p>
     SourceForge：
     <a href="https://sourceforge.net/projects/simplestffmpegmobile/">
      https://sourceforge.net/projects/simplestffmpegmobile/
     </a>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     CSDN工程下载地址：
     <a href="http://download.csdn.net/detail/leixiaohua1020/8924391">
      http://download.csdn.net/detail/leixiaohua1020/8924391
     </a>
    </p>
    <p>
     <br/>
    </p>
    本解决方案包含了使用FFmpeg在移动端处理多媒体的各种例子：
    <br/>
    <blockquote style="border-top:medium none;border-right:medium none;border-bottom:medium none;padding-bottom:0px;padding-top:0px;padding-left:0px;border-left:medium none;margin:0px 0px 0px 40px;padding-right:0px;">
     [Android]
     <br/>
     simplest_android_player: 基于安卓接口的视频播放器
     <br/>
     simplest_ffmpeg_android_helloworld: 安卓平台下基于FFmpeg的HelloWorld程序
     <br/>
     simplest_ffmpeg_android_decoder: 安卓平台下最简单的基于FFmpeg的视频解码器
     <br/>
     simplest_ffmpeg_android_decoder_onelib: 安卓平台下最简单的基于FFmpeg的视频解码器-单库版
     <br/>
     simplest_ffmpeg_android_streamer: 安卓平台下最简单的基于FFmpeg的推流器
     <br/>
     simplest_ffmpeg_android_transcoder: 安卓平台下移植的FFmpeg命令行工具
     <br/>
     simplest_sdl_android_helloworld: 移植SDL到安卓平台的最简单程序
     <br/>
     [IOS]
     <br/>
     simplest_ios_player: 基于IOS接口的视频播放器
     <br/>
     simplest_ffmpeg_ios_helloworld: IOS平台下基于FFmpeg的HelloWorld程序
     <br/>
     <span style="color:#ff0000;">
      simplest_ffmpeg_ios_decoder: IOS平台下最简单的基于FFmpeg的视频解码器
     </span>
     <br/>
     simplest_ffmpeg_ios_streamer: IOS平台下最简单的基于FFmpeg的推流器
     <br/>
     simplest_ffmpeg_ios_transcoder: IOS平台下移植的ffmpeg.c命令行工具
     <br/>
     simplest_sdl_ios_helloworld: 移植SDL到IOS平台的最简单程序
    </blockquote>
    <br/>
    <br/>
   </div>
  </div>
  <div style="display:none;" class="hide-article-box text-center csdn-tracking-statistics tracking-click" data-mod="popu_376">
   <a class="btn btn-red-hollow" id="btn-readmore">
    阅读更多
   </a>
  </div>
 </article>
 <div class="article-bar-bottom">
  <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。			https://blog.csdn.net/leixiaohua1020/article/details/47072257
  </div>
  <div class="tags-box artic-tag-box">
   <span class="label">
    文章标签：
   </span>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=FFmpeg&amp;t=blog" target="_blank">
    FFmpeg
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=IOS&amp;t=blog" target="_blank">
    IOS
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=视频&amp;t=blog" target="_blank">
    视频
   </a>
   <a class="tag-link" href="http://so.csdn.net/so/search/s.do?q=YUV&amp;t=blog" target="_blank">
    YUV
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    个人分类：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/leixiaohua1020/article/category/1360795" target="_blank">
    FFMPEG
   </a>
   <a class="tag-link" href="https://blog.csdn.net/leixiaohua1020/article/category/5680667" target="_blank">
    IOS多媒体
   </a>
  </div>
  <div class="tags-box">
   <span class="label">
    所属专栏：
   </span>
   <a class="tag-link" href="https://blog.csdn.net/column/details/ffmpeg-devel.html" target="_blank">
    FFmpeg
   </a>
  </div>
 </div>
 <!-- !empty($pre_next_article[0]) -->
</div>
<div class="recommend-box">
                            <div style="background: #fff; border: dashed 1px #666; padding-left: 1em; padding-top: 1em; padding-bottom: 1em;">
                                <span style="font-size: 0.8em; font-weight: bold;">
                                    此PDF由<a style="color:#0000ff" href="http://www.github.com/spygg"  target="_blank">spygg</a>生成,请尊重原作者版权!!!
                                    <br/>
                                    我的邮箱:liushidc@163.com
                                </span>
                                </div> 
                        </div>
                    </main>
      
                </div>

            <script>
                var recommendCount = 0;
                var articleTit = "";
                var articleId = "";
                var commentscount = 0;

                //1禁止评论，2正常
                var commentAuth = 1;
                //百度搜索
                var baiduKey = "";
                var needInsertBaidu = "";
            </script>
            <script src="https://csdnimg.cn/release/phoenix/template/js/detail-effe72036e.min.js"></script>
            </body>
        </html>